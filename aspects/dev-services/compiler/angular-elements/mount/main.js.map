{"version":3,"file":"main.js","sources":["../src/main.ts"],"sourcesContent":["import 'zone.js/dist/zone';\nimport { Injector, NgModule, NgModuleRef, Type, ɵNgModuleDef, destroyPlatform } from '@angular/core';\nimport { createCustomElement } from '@angular/elements';\nimport { BrowserModule, platformBrowser } from '@angular/platform-browser';\n\n// The injector used to create custom elements from Angular components\nlet counter = 0;\nconst DEFINED_ELEMENTS = new Map<Type<any>, string>()\n\n// Module used to load components directly (without any module)\n@NgModule({\n  imports: [BrowserModule]\n})\nclass AppModule {\n}\n\n// Bootstrap the AppModule\nfunction bootstrap<T>(module: any): Promise<NgModuleRef<T>> {\n  return platformBrowser()\n    .bootstrapModule<T>(module);\n}\nfunction maybeUnwrapFn<T>(value: T | (() => T)): T {\n  return value instanceof Function ? value() : value;\n}\n\nasync function insertComponent<T extends object>(components: Type<T>[], parentModule?: Type<T>): string[] {\n  const selectors: string[] = [];\n  const ngModuleRef = await bootstrap(parentModule || AppModule);\n  // @ts-ignore\n  const rootInjector = ngModuleRef.get(Injector);\n  components.forEach((component) => {\n    const definedSelector = DEFINED_ELEMENTS.get(component);\n    // That component has already been defined as a custom element\n    if(definedSelector) {\n      selectors.push(definedSelector);\n    } else {\n      let selector = Reflect.get(component, 'ɵcmp').selectors[0][0] as string;\n      // check if that selector is already used\n      if(customElements.get(selector)) {\n        selector = `${selector}_${++counter}`;\n      }\n      const custom = createCustomElement(component, { injector: rootInjector });\n      customElements.define(selector, custom);\n      DEFINED_ELEMENTS.set(component, selector);\n      selectors.push(selector);\n    }\n  });\n  return selectors;\n}\n\nasync function insertModule<T>(module: Type<T>): Promise<string[]> {\n  const moduleProps = Reflect.get(module, 'ɵmod') as ɵNgModuleDef<T>;\n  if (!moduleProps) {\n    // we are using view engine & JIT\n    throw new Error('View engine is not supported for compositions, please use ivy');\n  }\n  // we are using ivy & AOT\n  return insertComponent(maybeUnwrapFn(moduleProps.bootstrap), module);\n}\n\nexport async function loadAngularElement<T extends object>(moduleOrComponent: Type<T>): Promise<string[]> {\n  destroyPlatform();\n  if (Reflect.get(moduleOrComponent, 'ɵcmp')) {\n    return insertComponent([moduleOrComponent]);\n  } else if (Reflect.get(moduleOrComponent, 'ɵmod') || Reflect.get(moduleOrComponent, 'ngInjectorDef')) {\n    return insertModule(moduleOrComponent);\n  }\n\n  // We couldn't figure out the type of the exports from the composition\n  throw new Error(`Unknown type of composition for ${moduleOrComponent}, the Angular aspect only supports modules or components`);\n}\n"],"names":[],"mappings":";;;;;;AAKA;AACA,IAAI,OAAO,GAAG,CAAC,CAAC;AAChB,MAAM,gBAAgB,GAAG,IAAI,GAAG,EAAqB,CAAA;AAErD;AACA,MAGM,SAAS;;kEAAT,SAAS;2DAAT,SAAS;+DAFJ,CAAC,aAAa,CAAC;uFAEpB,SAAS;cAHd,QAAQ;eAAC;gBACR,OAAO,EAAE,CAAC,aAAa,CAAC;aACzB;;wFACK,SAAS,cAFH,aAAa;AAKzB;AACA,SAAS,SAAS,CAAI,MAAW;IAC/B,OAAO,eAAe,EAAE;SACrB,eAAe,CAAI,MAAM,CAAC,CAAC;AAChC,CAAC;AACD,SAAS,aAAa,CAAI,KAAoB;IAC5C,OAAO,KAAK,YAAY,QAAQ,GAAG,KAAK,EAAE,GAAG,KAAK,CAAC;AACrD,CAAC;AAED,eAAe,eAAe,CAAmB,UAAqB,EAAE,YAAsB;IAC5F,MAAM,SAAS,GAAa,EAAE,CAAC;IAC/B,MAAM,WAAW,GAAG,MAAM,SAAS,CAAC,YAAY,IAAI,SAAS,CAAC,CAAC;;IAE/D,MAAM,YAAY,GAAG,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC/C,UAAU,CAAC,OAAO,CAAC,CAAC,SAAS;QAC3B,MAAM,eAAe,GAAG,gBAAgB,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;;QAExD,IAAG,eAAe,EAAE;YAClB,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;SACjC;aAAM;YACL,IAAI,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAW,CAAC;;YAExE,IAAG,cAAc,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;gBAC/B,QAAQ,GAAG,GAAG,QAAQ,IAAI,EAAE,OAAO,EAAE,CAAC;aACvC;YACD,MAAM,MAAM,GAAG,mBAAmB,CAAC,SAAS,EAAE,EAAE,QAAQ,EAAE,YAAY,EAAE,CAAC,CAAC;YAC1E,cAAc,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;YACxC,gBAAgB,CAAC,GAAG,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;YAC1C,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC1B;KACF,CAAC,CAAC;IACH,OAAO,SAAS,CAAC;AACnB,CAAC;AAED,eAAe,YAAY,CAAI,MAAe;IAC5C,MAAM,WAAW,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAoB,CAAC;IACnE,IAAI,CAAC,WAAW,EAAE;;QAEhB,MAAM,IAAI,KAAK,CAAC,+DAA+D,CAAC,CAAC;KAClF;;IAED,OAAO,eAAe,CAAC,aAAa,CAAC,WAAW,CAAC,SAAS,CAAC,EAAE,MAAM,CAAC,CAAC;AACvE,CAAC;AAEM,eAAe,kBAAkB,CAAmB,iBAA0B;IACnF,eAAe,EAAE,CAAC;IAClB,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,MAAM,CAAC,EAAE;QAC1C,OAAO,eAAe,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC;KAC7C;SAAM,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,MAAM,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,eAAe,CAAC,EAAE;QACpG,OAAO,YAAY,CAAC,iBAAiB,CAAC,CAAC;KACxC;;IAGD,MAAM,IAAI,KAAK,CAAC,mCAAmC,iBAAiB,0DAA0D,CAAC,CAAC;AAClI;;;;"}